@model EPS3.ViewModels.ContractViewModel

@{
    ViewData["Title"] = "Review";
}
<script>
    @{
        decimal TotalAmount = 0.00M;
        foreach (LineItem item in (Model.LineItems))
        {
            TotalAmount = TotalAmount + item.Amount;
        }

    }
</script>
<h2>Review</h2>

<div class="container-fluid">
        <div class="panel panel-default" data-toggle="collapse" aria-expanded="true">
            <div class="panel-heading">
                <h3>
                    Contract - @Html.DisplayFor(model => model.Contract.ContractNumber)
                </h3>
                <div class="float-right align-top">
                    <h4>
                        <b>Current Status: </b> @Html.DisplayFor(model => model.Contract.CurrentStatus)
                    </h4>
                </div>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-sm-2">
                        <dl>
                            <dt>
                                @Html.DisplayNameFor(model => model.Contract.ContractNumber)
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.ContractNumber)
                            </dd>
                        </dl>
                    </div>
                    <div class="col-sm-2">
                        <dl>
                            <dt>
                                @Html.DisplayNameFor(model => model.Contract.ContractType)
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.ContractType.ContractTypeSelector)
                            </dd>
                        </dl>
                    </div>
                    <div class="col-sm-2">
                        <dl>
                            <dt>
                                @Html.DisplayNameFor(model => model.Contract.IsRenewable)
                            </dt>
                            <dd>
                                @(Model.Contract.IsRenewable.ToString().Equals("0") ? "No" : "Yes")
                            </dd>
                        </dl>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-2">
                        <dl>
                            <dt>
                                @Html.DisplayNameFor(model => model.Contract.ContractTotal)
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.ContractTotal)
                            </dd>
                        </dl>
                        <dl>
                            <dt>
                                @Html.DisplayNameFor(model => model.Contract.MaxLoaAmount)
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.MaxLoaAmount)
                            </dd>
                        </dl>
                        <dl>
                            <dt>
                                @Html.DisplayNameFor(model => model.Contract.BudgetCeiling)
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.BudgetCeiling)
                            </dd>
                        </dl>
                        <dl>
                            <dt>
                                Total of Encumbrance Requests
                            </dt>
                            <dd>
                                $@TotalAmount
                            </dd>
                        </dl>
                    </div>
                    <div class="col-sm-2">
                        <dl>
                            <dt>
                                @Html.LabelFor(model => model.Contract.BeginningDate, htmlAttributes: new { @class = "control-label" })
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.BeginningDate)
                            </dd>
                        </dl>
                        <dl>
                            <dt>
                                @Html.LabelFor(model => model.Contract.EndingDate, htmlAttributes: new { @class = "control-label" })
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.EndingDate)
                            </dd>
                        </dl>
                        <dl>
                            <dt>
                                @Html.LabelFor(model => model.Contract.ServiceEndingDate, htmlAttributes: new { @class = "control-label" })
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.ServiceEndingDate)
                            </dd>
                        </dl>
                    </div>
                    <div class="col-sm-3">
                        <dl>
                            <dt>
                                @Html.LabelFor(model => model.Contract.MethodOfProcurement, htmlAttributes: new { @class = "control-label" })
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.MethodOfProcurement.ProcurementSelector)
                            </dd>
                        </dl>
                        <dl>
                            <dt>
                                @Html.LabelFor(model => model.Contract.ContractFunding, htmlAttributes: new { @class = "control-label" })
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.ContractFunding.CompensationType)
                            </dd>
                        </dl>
                        <dl>
                            <dt>
                                @Html.LabelFor(model => model.Contract.Vendor, htmlAttributes: new { @class = "control-label" })
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.Vendor.VendorSelector)
                            </dd>
                        </dl>
                        <dl>
                            <dt>
                                @Html.LabelFor(model => model.Contract.Recipient, htmlAttributes: new { @class = "control-label" })
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.Recipient.RecipientSelector)
                            </dd>
                        </dl>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <dl>
                            <dt>
                                @Html.LabelFor(model => model.Contract.DescriptionOfWork, htmlAttributes: new { @class = "control-label" })
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Contract.DescriptionOfWork)
                            </dd>
                        </dl>
                    </div> <!-- close col -->
                </div><!-- close row -->
            </div><!-- close panel-body -->
        </div><!-- close panel -->
        <div>
            @if (ViewBag.Roles.Contains(ConstantStrings.AdminRole)
|| ViewBag.Roles.Contains(ConstantStrings.FinanceReviewer)
|| (ViewBag.Roles.Contains(ConstantStrings.Originator) && @ViewBag.CurrentUser.UserID == Model.Contract.UserID))
    {
        <a asp-action="Edit" asp-route-id="@Model.Contract.ContractID">Edit Contract Information</a> <br />
}
            <a asp-action="List">Back to Contract List </a>

            <br />
            </div >

            <div class="panel panel-default" data-toggle="collapse" aria-expanded="true">
                <div class="panel-heading">
                    <h3>Encumbrance Requests</h3>
                </div>
                <div class="panel-body row">
                    <div class="col-sm-12">
                        <table class="table table-striped table-bordered" id="lineItemTable" style="width: 100%">
                            <thead>
                                <tr>
                                    <th>
                                        <label for="OrgCode">Organization Code</label>
                                    </th>
                                    <th>
                                        <label for="ExpansionObject">Expansion Option</label>
                                    </th>
                                    <th>
                                        <label for="FlairObject">Object Code</label>
                                    </th>
                                    <th>
                                        <label for="Amount">Amount</label>
                                    </th>
                                    <th>
                                        <label for="FinancialProjectNumber">Fin Proj #</label>
                                    </th>
                                    <th>
                                        <label for="WorkActivity">Work Activity</label>
                                    </th>
                                    <th>
                                        <label for="Category">Category</label>
                                    </th>
                                    <th>
                                        <label for="OCA">OCA</label>
                                    </th>
                                    <th>
                                        <label for="StateProgram">State Program</label>
                                    </th>
                                    <th>
                                        <label for="FiscalYear">Fiscal Year</label>
                                    </th>
                                    <th>
                                        <label for="Fund">Fund</label>
                                    </th>
                                    <th>
                                        &nbsp;
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (LineItem item in (Model.LineItems))
                        {
                            <tr>
                                <td>
                                    <span id="OrgCode" name="OrgCode">55-@item.OrgCode</span>
                                </td>
                                <td>
                                    <span id="ExpansionObject" name="ExpansionObject">@item.ExpansionObject</span>
                                </td>
                                <td>
                                    <span id="FlairObject" name="FlairObject">@item.FlairObject</span>
                                </td>
                                <td>
                                    <span id="Amount" name="Amount">@item.Amount.ToString("C")</span>
                                </td>
                                <td>
                                    <span id="FinancialProjectNumber" name="FinancialProjectNumber">@item.FinancialProjectNumber</span>
                                </td>
                                <td>
                                    <span id="WorkActivity" name="WorkActivity">@item.WorkActivity</span>
                                </td>
                                <td>
                                    <span id="Category" name="Category">@item.Category.CategorySelector</span>
                                </td>
                                <td>
                                    <span id="OCA" name="OCA">@item.OCA.OCASelector</span>
                                </td>
                                <td>
                                    <span id="StateProgram" name="StateProgram">@item.StateProgram.ProgramSelector</span>
                                </td>
                                <td>
                                    <span id="FiscalYear" name="FiscalYear">@item.FiscalYear</span>
                                </td>
                                <td>
                                    <span id="Fund" name="Fund">@item.Fund.FundSelector</span>
                                </td>
                                <td>
                                    @if (ViewBag.Roles.Contains(ConstantStrings.AdminRole)
|| ViewBag.Roles.Contains(ConstantStrings.FinanceReviewer)
|| (ViewBag.Roles.Contains(ConstantStrings.Originator) && @ViewBag.CurrentUser.UserID == Model.Contract.UserID))
                            {
                                    <a asp-controller="LineItems" asp-action="Edit" asp-route-id="@item.LineItemID">Edit Encumbrance Request</a> <br />
                    }
                                </td>
                            </tr>
                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div>
                @if (ViewBag.Roles.Contains(ConstantStrings.AdminRole)
        || ViewBag.Roles.Contains(ConstantStrings.FinanceReviewer)
        || (ViewBag.Roles.Contains(ConstantStrings.Originator) && @ViewBag.CurrentUser.UserID == Model.Contract.UserID))
        {
                <a asp-controller="LineItems" asp-action="Create" asp-route-id="@Model.Contract.ContractID">Add Encumbrance Request</a>
}
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3>History</h3>
                </div>
                <div class="panel-body">
                    <form asp-action="Review">
                        <div class="row">
                            <div class="col-sm-12">
                                <table class="table table-striped table-bordered" id="lineItemTable" style="width: 100%">
                                    <thead>
                                        <tr>
                                            <th>
                                                Updated By
                                            </th>
                                            <th>
                                                Status Date
                                            </th>
                                            <th>
                                                Status
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (ContractStatus status in Model.Statuses)
                                {
                                    <tr>
                                        <td>
                                            <a href="mailto:@status.User.Email">@status.User.FirstName @status.User.LastName</a>
                                        </td>
                                        <td>
                                            @status.SubmittalDate
                                        </td>
                                        <td>
                                            @status.CurrentStatus
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="3">
                                            <b>Comments: </b>@status.Comments
                                        </td>
                                    </tr>
                        }
                                    </tbody>
                                </table>
                            </div> <!-- end column -->
                        </div> <!-- end row -->
                        <div class="row">
                            <div class="col-sm-4">
                                <dl>
                                    <dt>
                                        Contract Status
                                    </dt>
                                    <dd>
                                <select id='CurrentStatus' name='CurrentStatus' class='form-control'>
                                   @if (ViewBag.Roles.Contains(ConstantStrings.AdminRole)
                                   || ViewBag.Roles.Contains(ConstantStrings.FinanceReviewer)
                                   || (ViewBag.Roles.Contains(ConstantStrings.Originator) && ViewBag.CurrentUser.UserID == ViewBag.Contract.UserID))
                                    {
                                    <option value='ContractDrafted'>@ConstantStrings.ContractDrafted</option>
                                    <option value='ContractInCFM'>@ConstantStrings.ContractInCFM</option>
                                    }
                                  @if (ViewBag.Roles.Contains(ConstantStrings.AdminRole)
                                  || ViewBag.Roles.Contains(ConstantStrings.FinanceReviewer))
                                    {
                                    <option value='ContractComplete50'>@ConstantStrings.ContractComplete50</option>
                                    <option value='ContractComplete52'>@ConstantStrings.ContractComplete52</option>
                                    <option value='ContractComplete98'>@ConstantStrings.ContractComplete98</option>
                                    <option value='ContractArchived'>@ConstantStrings.ContractArchived</option>
                                    }
                                </select>
                                    </dd>
                                </dl>
                            </div> <!-- end column -->
                            <div class="form-group col-sm-4">
                                <dl>
                                    <dt>
                                        Comments
                                    </dt>
                                    <dd>
                                        <textarea id="Comments" name="Comments" class="form-control"></textarea>
                                    </dd>
                                </dl>
                            </div> <!-- end column -->
                        </div> <!-- end row -->

                        <div class="row">
                            <div class="col-sm-4">
                                <input type="hidden" name="contractId" id="contractId" value="@Model.Contract.ContractID" />
                                <input type="hidden" name="userID" id="userID" value="@Model.Contract.UserID" />
                                <input type="submit" value="Update" class="btn btn-default" title="Update Contract" />
                            </div> <!-- end column -->
                        </div> <!-- end row -->
                    </form> <!-- end form -->
                </div> <!-- end panel body -->
            </div> <!-- end panel -->
        </div>
