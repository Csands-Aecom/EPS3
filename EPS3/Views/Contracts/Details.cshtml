@model EPS3.ViewModels.EncumbranceRequestViewModel

@{
    ViewData["Title"] = "Details";
}
<script>
    @{
        decimal TotalAmount = 0.00M;
        if (ViewData["LineItems"] != null)
        {
            foreach (LineItem item in (IEnumerable<LineItem>)ViewData["LineItems"] as IEnumerable<LineItem>)
            {
                TotalAmount = TotalAmount + item.Amount;
            }
        }
    }
</script>
<h2>Details</h2>

<div class="container-fluid">
    <div class="panel panel-default" data-toggle="collapse" aria-expanded="true">
        <div class="panel-heading">
            <h3>
                Contract - @Html.DisplayFor(model => model.Contract.ContractNumber)
            </h3>
            <div class="float-right align-top">
                <h4>
                    <b>Current Status: </b> @Html.DisplayFor(model => model.Contract.CurrentStatus)
                </h4>
            </div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-sm-2">
                    <dl>
                        <dt>
                            @Html.DisplayNameFor(model => model.Contract.ContractNumber)
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.ContractNumber)
                        </dd>
                    </dl>
                </div>
                <div class="col-sm-2">
                    <dl>
                        <dt>
                            @Html.DisplayNameFor(model => model.Contract.ContractType)
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.ContractType.ContractTypeSelector)
                        </dd>
                    </dl>
                </div>
                <div class="col-sm-2">
                    <dl>
                        <dt>
                            @Html.DisplayNameFor(model => model.Contract.IsRenewable)
                        </dt>
                        <dd>
                            @(Model.Contract.IsRenewable.ToString().Equals("0") ? "No" : "Yes")
                        </dd>
                    </dl>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-2">
                    <dl>
                        <dt>
                            @Html.DisplayNameFor(model => model.Contract.ContractTotal)
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.ContractTotal)
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            @Html.DisplayNameFor(model => model.Contract.MaxLoaAmount)
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.MaxLoaAmount)
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            @Html.DisplayNameFor(model => model.Contract.BudgetCeiling)
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.BudgetCeiling)
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            Total of Encumbrance Requests
                        </dt>
                        <dd>
                            $@TotalAmount
                        </dd>
                    </dl>
                </div>
                <div class="col-sm-2">
                    <dl>
                        <dt>
                            @Html.LabelFor(model => model.Contract.BeginningDate, htmlAttributes: new { @class = "control-label" })
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.BeginningDate)
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            @Html.LabelFor(model => model.Contract.EndingDate, htmlAttributes: new { @class = "control-label" })
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.EndingDate)
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            @Html.LabelFor(model => model.Contract.ServiceEndingDate, htmlAttributes: new { @class = "control-label" })
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.ServiceEndingDate)
                        </dd>
                    </dl>
                </div>
                <div class="col-sm-3">
                    <dl>
                        <dt>
                            @Html.LabelFor(model => model.Contract.MethodOfProcurement, htmlAttributes: new { @class = "control-label" })
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.MethodOfProcurement.ProcurementSelector)
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            @Html.LabelFor(model => model.Contract.ContractFunding, htmlAttributes: new { @class = "control-label" })
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.ContractFunding.CompensationType)
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            @Html.LabelFor(model => model.Contract.Vendor, htmlAttributes: new { @class = "control-label" })
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.Vendor.VendorSelector)
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            @Html.LabelFor(model => model.Contract.Recipient, htmlAttributes: new { @class = "control-label" })
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.Recipient.RecipientSelector)
                        </dd>
                    </dl>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <dl>
                        <dt>
                            @Html.LabelFor(model => model.Contract.DescriptionOfWork, htmlAttributes: new { @class = "control-label" })
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Contract.DescriptionOfWork)
                        </dd>
                    </dl>
                </div> <!-- close col -->
            </div><!-- close row -->
        </div><!-- close panel-body -->
    </div><!-- close panel -->
    <div>
        @if (ViewBag.Roles.Contains(ConstantStrings.AdminRole)
      || ViewBag.Roles.Contains(ConstantStrings.FinanceReviewer)
      || (ViewBag.Roles.Contains(ConstantStrings.Originator) && @ViewBag.CurrentUser.UserID == Model.Contract.UserID))
        {
            <a asp-action="Edit" asp-route-id="@Model.Contract.ContractID">Edit Contract Information</a>
        }
        <a asp-action="List" asp-controller="LineItemGroups"> Back to List </a>

    </div>

    <br />
    @foreach (LineItemGroup encumbrance in Model.LineItemGroups)
    {
    <div class="panel panel-default" data-toggle="collapse" aria-expanded="true">
        <div class="panel-heading">
            <h4>Encumbrance @encumbrance.GroupID</h4>
            <div class="row">
                <div class="col-sm-2">
                    <label for="@encumbrance.CurrentStatus">Status:</label>
                    @encumbrance.CurrentStatus
                </div>
                <div class="col-sm-2">
                    <label for="@encumbrance.LineItemType">Type:</label>
                    @encumbrance.LineItemType
                    @if (encumbrance.LettingDate != null)
                    {
                        <label for="@encumbrance.LettingDate">Letting Date:</label>
                        @encumbrance.LettingDate
                    }
                </div>
                <div class="col-sm-2">
                    <label for="encumbranceAmount_@encumbrance.GroupID">Amount:</label>
                    Amount
                </div>
            </div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-sm-12">
                <h4>History</h4>
                <table>
                    <tr>
                        <th>
                            Date
                        </th>
                        <th>
                            Commenter
                        </th>
                        <th>
                            Status
                        </th>
                        <th>
                            Comment
                        </th>
                    </tr>
                    @foreach (LineItemGroupStatus status in encumbrance.Statuses) {
                    <tr>
                        <td>
                            @status.SubmittalDate
                        </td>
                        <td>
                            @status.User.FullName
                        </td>
                        <td>
                            @status.CurrentStatus
                        </td>
                        <td>
                            @status.Comments
                        </td>
                    </tr>
                    }
                </table>
                </div>
            </div>
        </div>
        <div class="panel-body ">
            <div class="col-sm-12">
                <table class="table table-striped table-bordered" id="lineItemTable" style="width: 100%">
                    <thead>
                        <tr>
                            <th>
                                <label for="OrgCode">Organization Code</label>
                            </th>
                            <th>
                                <label for="ExpansionObject">Expansion Option</label>
                            </th>
                            <th>
                                <label for="FlairObject">Object Code</label>
                            </th>
                            <th>
                                <label for="Amount">Amount</label>
                            </th>
                            <th>
                                <label for="FinancialProjectNumber">Fin Proj #</label>
                            </th>
                            <th>
                                <label for="WorkActivity">Work Activity</label>
                            </th>
                            <th>
                                <label for="Category">Category</label>
                            </th>
                            <th>
                                <label for="OCA">OCA</label>
                            </th>
                            <th>
                                <label for="StateProgram">State Program</label>
                            </th>
                            <th>
                                <label for="FiscalYear">Fiscal Year</label>
                            </th>
                            <th>
                                <label for="Fund">Fund</label>
                            </th>
                            <th>
                                &nbsp;
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                            @foreach (LineItem item in encumbrance.LineItems)
                            {
                            <tr>
                                <td>
                                    <span id="OrgCode" name="OrgCode">55-@item.OrgCode</span>
                                </td>
                                <td>
                                    <span id="ExpansionObject" name="ExpansionObject">@item.ExpansionObject</span>
                                </td>
                                <td>
                                    <span id="FlairObject" name="FlairObject">@item.FlairObject</span>
                                </td>
                                <td>
                                    <span id="Amount" name="Amount">@item.Amount.ToString("C")</span>
                                </td>
                                <td>
                                    <span id="FinancialProjectNumber" name="FinancialProjectNumber">@item.FinancialProjectNumber</span>
                                </td>
                                <td>
                                    <span id="WorkActivity" name="WorkActivity">@item.WorkActivity</span>
                                </td>
                                <td>
                                    <span id="Category" name="Category">@item.Category.CategorySelector</span>
                                </td>
                                <td>
                                    <span id="OCA" name="OCA">@item.OCA.OCASelector</span>
                                </td>
                                <td>
                                    <span id="StateProgram" name="StateProgram">@item.StateProgram.ProgramSelector</span>
                                </td>
                                <td>
                                    <span id="FiscalYear" name="FiscalYear">@item.FiscalYear</span>
                                </td>
                                <td>
                                    <span id="Fund" name="Fund">@item.Fund.FundSelector</span>
                                </td>
                                <td>
                                    @if (ViewBag.Roles.Contains(ConstantStrings.AdminRole)
                                        || ViewBag.Roles.Contains(ConstantStrings.FinanceReviewer)
                                        || (ViewBag.Roles.Contains(ConstantStrings.Originator) 
                                        && @ViewBag.CurrentUser.UserID == Model.Contract.UserID))
                                    {
                                        <a asp-controller="LineItemGroups" asp-action="Manage" asp-route-id="@item.LineItemID">Edit</a> <br />
                                    }
                                </td>
                            </tr>
                            }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    }
       